<!DOCTYPE html>
<html>
<head>
	<style>
		span {
			font-family: 'Courier New', Courier, monospace;
		}
		.json {
			padding: 5px;
		}

		.json:hover {
			border: 1px solid #000000;
		}

		.key {
			padding-left: 20px;
		}

		.left {
			float: left;
		}

		.right {
			float: right;
		}

		.column {
			width: 50%;
			max-width: 50%;
			height: 300px;
			resize: both;
			overflow: scroll;
		}
	</style>
</head>
<body>
	<div>
		<h1>Input</h1>
		<span>
			<textarea id="input">{ "one": { "two": "three" } }
			</textarea>
			<button onclick="go();">Go</button>
		</span>
	</div>
	<div>
		<div class="left column">
			<h1>Viewer</h1>
			<p>Click on a value to edit it in the Editor</p>
			<div id="root" class="viewer"></div>
		</div>
		<div class="right column">
			<h1>Editor</h1>
			<textarea id="editor" class="editor"></textarea>
			<button onclick="update();">Update</button>
		</div>
	</div>
</body>
<script>
"use strict";

const rootElement = document.getElementById("root");
const inputElement = document.getElementById("input");
const editorElement = document.getElementById("editor");

const valueMap = new Map();

function renderJson(value, parentElement, parentObject, parentObjectKeyName) {
	const valueType = typeof value;
	const isUndefined = valueType === "undefined";
	const isNull = value === null;

	function getElement(tagName, content) {
		const divElement = document.createElement(tagName);
		divElement.textContent = content;
		return divElement;
	}

	function getDivElement(content) { return getElement("div", content); }

	function getSpanElement(content) { return getElement("span", content); }

	function getStringDisplayValue(value) { return "\"" + value + "\""; }

	let valueElement;
	if (!isUndefined) {
		switch (valueType) {
			case "string":
			case "number":
			case "boolean":
				const displayValue = (valueType === "string") ? getStringDisplayValue(value): value;
				valueElement = getSpanElement(displayValue);
				break;
			case "object":
				if (isNull) {
					valueElement = getSpanElement("null");
				} else {
					valueElement = document.createElement("div");
					const isArray = Array.isArray(value);
					const openingChar = (isArray) ? "[" : "{";
					const closingChar = (isArray) ? "]" : "}";
					const childElements = [];
					childElements.push(getDivElement(openingChar));

					const objectKeys = Object.keys(value);
					const lastKeyIndex = objectKeys.length - 1;
					objectKeys.forEach(function createKey(keyName, keyIndex) {
						const keyElement = document.createElement("div");
						if (!isArray) {
							keyElement.appendChild(getSpanElement(getStringDisplayValue(keyName)));
							keyElement.appendChild(getSpanElement(":"));
						}
						keyElement.className = "key";

						renderJson(value[keyName], keyElement, value, keyName);

						if (keyIndex < lastKeyIndex) {
							keyElement.appendChild(getSpanElement(","));
						}

						childElements.push(keyElement);
					});

					childElements.push(getDivElement(closingChar));

					childElements.forEach(function append(childElement) {
						valueElement.appendChild(childElement);
					});
				}
				break;
		}
	}

	valueElement.className = "json";

	valueMap.set(valueElement, {
		parent: parentObject,
		parentKey: parentObjectKeyName,
		value: value
	});
	valueElement.addEventListener("click", clickHandler);

	parentElement.appendChild(valueElement);
}

function go() {
	// clean
	valueMap.clear();
	while (rootElement.lastChild) {
		rootElement.removeChild(rootElement.lastChild)
	}

	// build new
	const inputJsonString = inputElement.value.trim();
	workingValue = JSON.parse(inputJsonString);

	renderJson(workingValue, rootElement);
}

function update() {
	const newValue = JSON.parse(editorElement.value);

	if (selectedParent && selectedParentKeyName) {
		selectedParent[selectedParentKeyName] = newValue;
	} else {
		workingValue = newValue;
	}

	inputElement.value = JSON.stringify(workingValue, null, 2);
	go();
}

let workingValue = null;
let selectedParent = null;
let selectedParentKeyName = null;

function clickHandler(event) {
	event.stopPropagation();
	const record = valueMap.get(event.currentTarget);

	selectedParent = record.parent;
	selectedParentKeyName = record.parentKey;

	editorElement.value = JSON.stringify(record.value, null, 2);
}

</script>
</html>